<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="keywords" content="wrappixel, admin dashboard, html css dashboard, web dashboard, bootstrap 5 admin, bootstrap 5, css3 dashboard, bootstrap 5 dashboard, Flexy lite admin bootstrap 5 dashboard, frontend, responsive bootstrap 5 admin template, Flexy admin lite design, Flexy admin lite dashboard bootstrap 5 dashboard template">
  <meta name="description" content="Flexy Admin Lite is powerful and clean admin dashboard template, inpired from Bootstrap Framework">
  <meta name="robots" content="noindex,nofollow">
  <title>Produk - IndoApril</title>
  <link rel="canonical" href="https://www.wrappixel.com/templates/Flexy-admin-lite/" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon.png">
  <link href="dist/css/style.min.css" rel="stylesheet">
  <link rel="stylesheet" href="//cdn.datatables.net/2.2.2/css/dataTables.dataTables.min.css">
</head>

<body>
  <div id="main-wrapper" data-layout="vertical" data-navbarbg="skin5" data-sidebartype="full" data-sidebar-position="absolute" data-header-position="absolute" data-boxed-layout="full">
    <!-- Start Header -->
    <header class="topbar" data-navbarbg="skin6">
      <nav class="navbar top-navbar navbar-expand-md navbar-light">
        <div class="navbar-header" data-logobg="skin6">
          <a class="navbar-brand" href="index.html">
            <b class="logo-icon">
              <img src="assets/images/logo-icon.png" alt="homepage" class="dark-logo" />
              <img src="assets/images/logo-light-icon.png" alt="homepage" class="light-logo" />
            </b>
            <span class="logo-text">
              <img src="assets/images/logo-text.png" alt="homepage" class="dark-logo" />
              <img src="assets/images/logo-light-text.png" class="light-logo" alt="homepage" />
            </span>
          </a>
          <a class="nav-toggler waves-effect waves-light d-block d-md-none" href="javascript:void(0)">
            <i class="mdi mdi-menu"></i>
          </a>
        </div>

        <div class="navbar-collapse collapse" id="navbarSupportedContent" data-navbarbg="skin5">
          <ul class="navbar-nav float-end ms-auto">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle text-muted waves-effect waves-dark pro-pic" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <img src="assets/images/users/profile.png" alt="user" class="rounded-circle" width="31">
              </a>
              <ul class="dropdown-menu dropdown-menu-end user-dd animated" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="javascript:void(0)">
                  <i class="mdi mdi-account-box"></i>
                  Administrator
                </a>
                <a class="dropdown-item" href="">
                  <i class="mdi mdi-logout"></i>
                  Logout
                </a>
              </ul>
            </li>
          </ul>
        </div>
      </nav>
    </header>
    <!-- End Header -->

    <!-- Start Aside -->
    <aside class="left-sidebar" data-sidebarbg="skin6">
      <div class="scroll-sidebar">
        <nav class="sidebar-nav">
          <ul id="sidebarnav">
            <li class="sidebar-item">
              <a class="sidebar-link waves-effect waves-dark sidebar-link" href="index.html" aria-expanded="false">
                <i class="mdi mdi-view-dashboard"></i>
                <span class="hide-menu">Dashboard</span>
              </a>
            </li>
            <li class="sidebar-item">
              <a class="sidebar-link waves-effect waves-dark sidebar-link" href="product.html" aria-expanded="false">
                <i class="mdi mdi-store"></i>
                <span class="hide-menu">Produk</span>
              </a>
            </li>
            <li class="sidebar-item selected">
              <a class="sidebar-link waves-effect waves-dark sidebar-link" href="transaction.html" aria-expanded="false">
                <i class="mdi mdi-cart"></i>
                <span class="hide-menu">Pembelian</span>
              </a>
            </li>
            <li class="sidebar-item">
              <a class="sidebar-link waves-effect waves-dark sidebar-link" href="user.html" aria-expanded="false">
                <i class="mdi mdi-account"></i>
                <span class="hide-menu">User</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </aside>
    <!-- End Aside -->

    <!-- Start Main Content -->
    <div class="page-wrapper">
      <div class="page-breadcrumb ">
        <div class="row align-items-center">
          <div class="col-6">
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb mb-0 d-flex align-items-center">
                <li class="breadcrumb-item"><a href="index.html" class="link"><i class="mdi mdi-home-outline fs-4"></i></a></li>
                <li class="breadcrumb-item active" aria-current="page">Penjualan</li>
              </ol>
            </nav>
            <h1 class="mb-0 fw-bold">Penjualan</h1> 
          </div>
        </div>
      </div>
      <div class="container-fluid d-flex flex-column" style="min-height: 500px">
        <div class="row">
          <div class="col-12 max-h-auto">
            <div class="card">
              <div class="card-body">
                <div class="row">
                  <div class="col-md-5 p-0">
                    <form action="#" method="POST">
                      <table class="table table-sm" id="cartTable">
                        <thead>
                          <tr>
                            <th scope="col"></th>
                            <th scope="col">Nama</th>
                            <th scope="col">Harga</th>
                            <th scope="col">Kuantitas</th>
                            <th scope="col">Subtotal</th>
                          </tr>
                        </thead>
                        <tbody class="table-group-divider">
                        </tbody>
                        <tfoot class="table-group-divider">
                          <th scope="col" colspan="4" class="text-center">Total</th>
                          <td id="totalAmount">Rp 0</td>
                        </tfoot>
                      </table>
                      <input type="hidden" name="items" id="items">
                      <input type="hidden" name="user_id" value="{{ Auth::user()->id }}">
                      <input type="hidden" name="total" id="total" value="0">
                      <div class="row">
                        <div class="form-group">
                          <label for="member" class="col-md-12">Member Status <small class="text-danger">Dapat juga membuat member</small></label>
                          <div class="col-md-12">
                            <select class="form-select shadow-none form-control-line" name="status" id="status">
                              <option selected disabled hidden>Pilih Status Pelanggan</option>
                              <option value="member">Member</option>
                              <option value="non-member">Non-Member</option>
                            </select>
                          </div>
                        </div>
                      </div>
                      <div class="row" id="phoneNumberContainer" style="display: none;">
                        <div class="form-group">
                          <label for="phone_number" class="col-md-12">Nomor Telepon <small class="text-danger">(daftar/gunakan member)</small></label>
                          <div class="col-md-12">
                            <input type="text" class="form-control form-control-line" id="phone_number" name="phone_number">
                            <div class="invalid-feedback">
                              Nomor telepon produk harus diisi!
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="form-group">
                          <label for="total_pay" class="col-md-12">Total Bayar</label>
                          <div class="col-md-12">
                            <input type="text" name="amount_paid" class="form-control form-control-line" id="total_pay" oninput="formatRupiah(this); checkTotalPay()" placeholder="Rp. 0">
                            <small id="error-message" class="text-danger d-none">Jumlah bayar kurang</small>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-12 text-end">
                          <button class="btn btn-primary" type="submit">Pesan</button>
                        </div>
                      </div>
                    </form>
                  </div>
                  <div class="col-md-7 overflow-auto" style="max-height: 500px">
                    <div class="row g-3">
                      <div class="col-md-4 col-sm-6">
                        <div class="card">
                          <img src="storage/product-1.jpg" class="card-img-top" alt="Produk 1">
                          <div class="card-body">
                            <h5 class="card-title">Produk 1</h5>
                            <p class="card-text fw-bold">Stok 10</p>
                            <p class="card-text">Rp. 100.000</p>
                            <button class="btn btn-primary add-to-cart" data-id="1" data-name="Produk 1" data-price="100000" data-stock="10">
                              Tambah
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-4 col-sm-6">
                        <div class="card">
                          <img src="storage/product-1.jpg" class="card-img-top" alt="Produk 1">
                          <div class="card-body">
                            <h5 class="card-title">Produk 2</h5>
                            <p class="card-text fw-bold">Stok 10</p>
                            <p class="card-text">Rp. 100.000</p>
                            <button class="btn btn-primary add-to-cart" data-id="2" data-name="Produk 2" data-price="100000" data-stock="10">
                              Tambah
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-4 col-sm-6">
                        <div class="card">
                          <img src="storage/product-1.jpg" class="card-img-top" alt="Produk 1">
                          <div class="card-body">
                            <h5 class="card-title">Produk 3</h5>
                            <p class="card-text fw-bold">Stok 10</p>
                            <p class="card-text">Rp. 100.000</p>
                            <button class="btn btn-primary add-to-cart" data-id="3" data-name="Produk 3" data-price="100000" data-stock="10">
                              Tambah
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-4 col-sm-6">
                        <div class="card">
                          <img src="storage/product-1.jpg" class="card-img-top" alt="Produk 1">
                          <div class="card-body">
                            <h5 class="card-title">Produk 4</h5>
                            <p class="card-text fw-bold">Stok 10</p>
                            <p class="card-text">Rp. 100.000</p>
                            <button class="btn btn-primary add-to-cart" data-id="4" data-name="Produk 4" data-price="100000" data-stock="10">
                              Tambah
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- End Main Content -->
  </div>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="assets/libs/jquery/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  <script src="//cdn.datatables.net/2.2.2/js/dataTables.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const totalPayInput = document.querySelector("#total_pay");
    const totalAmount = document.querySelector("#totalAmount");
    const errorMessage = document.getElementById("error-message");
    const submitButton = document.querySelector("button[type='submit']");

    function formatRupiah(value) {
      return new Intl.NumberFormat("id-ID", {
        style: "currency",
        currency: "IDR",
        minimumFractionDigits: 0
      }).format(value).replace("Rp", "Rp.").trim();
    }

    function checkTotalPay() {
      const totalPayValue = parseInt(totalPayInput.value.replace(/[^0-9]/g, ''), 10) || 0;
      const totalValue = parseInt(totalAmount.textContent.replace(/[^0-9]/g, ''), 10) || 0;

      if (totalPayValue < totalValue) {
          errorMessage.classList.remove('d-none');
          submitButton.disabled = true;
      } else {
          errorMessage.classList.add('d-none');
          submitButton.disabled = false;
      }
    }

    document.addEventListener("DOMContentLoaded", function () {
      const cartTableBody = document.querySelector("#cartTable tbody");
      const itemsInput = document.querySelector("#items");
      const statusSelect = document.querySelector("#status");
      const phoneNumberContainer = document.querySelector("#phoneNumberContainer");
      
      let cart = [];

      function updateCartTable() {
        cartTableBody.innerHTML = "";
        let total = 0;

        cart.forEach((item, index) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td><button class="btn btn-danger btn-sm remove-item" data-index="${index}">X</button></td>
            <td>${item.name}</td>
            <td>Rp ${item.price.toLocaleString()}</td>
            <td><input type="number" class="form-control form-control-sm update-qty" data-index="${index}" value="${item.quantity}" min="1" max="${item.stock}"></td>
            <td>Rp ${(item.price * item.quantity).toLocaleString()}</td>
          `;
          cartTableBody.appendChild(row);
          total += item.price * item.quantity;
        });
        
        totalAmount.textContent = `Rp ${total.toLocaleString()}`;
        itemsInput.value = JSON.stringify(cart);
        document.querySelector("#total").value = total;

        checkTotalPay();
      }

      totalPayInput.addEventListener("input", function () {
        let rawValue = this.value.replace(/[^0-9]/g, "");
        this.dataset.rawValue = rawValue;
        this.value = formatRupiah(rawValue);
        checkTotalPay(); 
      });

      document.querySelectorAll(".add-to-cart").forEach(button => {
        button.addEventListener("click", function () {
          const id = this.getAttribute("data-id");
          const name = this.getAttribute("data-name");
          const price = parseInt(this.getAttribute("data-price"));
          const stock = parseInt(this.getAttribute("data-stock"));
          
          let existingItem = cart.find(item => item.id === id);
          
          if (existingItem) {
            if (existingItem.quantity < stock) {
              existingItem.quantity += 1;
            } else {
              alert("Stok tidak mencukupi");
            }
          } else {
            cart.push({ id, name, price, quantity: 1, stock });
          }
          updateCartTable();
        });
      });

      cartTableBody.addEventListener("click", function (event) {
        if (event.target.classList.contains("remove-item")) {
          const index = event.target.getAttribute("data-index");
          cart.splice(index, 1);
          updateCartTable();
        }
      });

      cartTableBody.addEventListener("input", function (event) {
        if (event.target.classList.contains("update-qty")) {
          const index = event.target.getAttribute("data-index");
          const newQty = parseInt(event.target.value);
          if (newQty > 0 && newQty <= cart[index].stock) {
            cart[index].quantity = newQty;
          } else {
            event.target.value = cart[index].quantity;
            alert("Jumlah melebihi stok tersedia");
          }
          updateCartTable();
        }
      });

      statusSelect.addEventListener("change", function () {
        if (statusSelect.value === "member") {
          phoneNumberContainer.style.display = "block";
        } else {
          phoneNumberContainer.style.display = "none";
        }
      });

      totalPayInput.addEventListener("input", function () {
        let rawValue = this.value.replace(/[^0-9]/g, "");
        this.dataset.rawValue = rawValue;
        this.value = formatRupiah(rawValue);
      });

      document.querySelector("form").addEventListener("submit", function (e) {
        const phoneNumberInputField = document.getElementById('phone_number');
        
        if (cart.length === 0) {
          e.preventDefault();
          showBasicAlert('', 'Silahkan pilih produk yang ingin dibeli!', 'warning');
          return;
        }   
        
        if (statusSelect.value === "member" && phoneNumberInputField.value.trim() === "") {
          e.preventDefault();
          phoneNumberInputField.classList.add('is-invalid');
          return;
        } else {
          phoneNumberInputField.classList.remove('is-invalid');
        }

        totalPayInput.value = totalPayInput.dataset.rawValue || "0";
      });
    });
  </script>
</body>
</html>